<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>${sitename}:${page_name}</title>

    <!-- load stylesheets -->
    <link rel="stylesheet" type='text/css'
          href="https://leiho-1252251484.cos.ap-shanghai.myqcloud.com/%E5%BC%80%E5%8F%91%E7%94%A8%E6%96%87%E4%BB%B6%E5%A4%B9/x-space/bootstrap.min.css">
    <!-- Bootstrap style -->
    <link rel="stylesheet" type='text/css' href="/css/templatemo-style.css">
    <!-- Templatemo style -->
    <link rel="stylesheet" type='text/css' href="/font-awesome-4.7.0/css/font-awesome.min.css">
    <!-- Templatemo style -->
    <link rel="stylesheet" type='text/css' href="/css/buttons.css">
    <!-- Templatemo style -->
    <link rel="stylesheet" type='text/css' href="/highlight/styles/github.css">
    <!-- Templatemo style -->
    <style>
        body{
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='158' height='158' viewBox='0 0 200 200'%3E%3Cg fill='none' stroke='%23cf8b3c' stroke-width='0.7' stroke-opacity='0.25'%3E%3Crect x='-40' y='40' width='75' height='75'/%3E%3Crect x='-35' y='45' width='65' height='65'/%3E%3Crect x='-30' y='50' width='55' height='55'/%3E%3Crect x='-25' y='55' width='45' height='45'/%3E%3Crect x='-20' y='60' width='35' height='35'/%3E%3Crect x='-15' y='65' width='25' height='25'/%3E%3Crect x='-10' y='70' width='15' height='15'/%3E%3Crect x='-5' y='75' width='5' height='5'/%3E%3Crect width='35' height='35'/%3E%3Crect x='5' y='5' width='25' height='25'/%3E%3Crect x='10' y='10' width='15' height='15'/%3E%3Crect x='15' y='15' width='5' height='5'/%3E%3Crect x='40' width='75' height='75'/%3E%3Crect x='45' y='5' width='65' height='65'/%3E%3Crect x='50' y='10' width='55' height='55'/%3E%3Crect x='55' y='15' width='45' height='45'/%3E%3Crect x='60' y='20' width='35' height='35'/%3E%3Crect x='65' y='25' width='25' height='25'/%3E%3Crect x='70' y='30' width='15' height='15'/%3E%3Crect x='75' y='35' width='5' height='5'/%3E%3Crect x='40' y='80' width='35' height='35'/%3E%3Crect x='45' y='85' width='25' height='25'/%3E%3Crect x='50' y='90' width='15' height='15'/%3E%3Crect x='55' y='95' width='5' height='5'/%3E%3Crect x='120' y='-40' width='75' height='75'/%3E%3Crect x='125' y='-35' width='65' height='65'/%3E%3Crect x='130' y='-30' width='55' height='55'/%3E%3Crect x='135' y='-25' width='45' height='45'/%3E%3Crect x='140' y='-20' width='35' height='35'/%3E%3Crect x='145' y='-15' width='25' height='25'/%3E%3Crect x='150' y='-10' width='15' height='15'/%3E%3Crect x='155' y='-5' width='5' height='5'/%3E%3Crect x='120' y='40' width='35' height='35'/%3E%3Crect x='125' y='45' width='25' height='25'/%3E%3Crect x='130' y='50' width='15' height='15'/%3E%3Crect x='135' y='55' width='5' height='5'/%3E%3Crect y='120' width='75' height='75'/%3E%3Crect x='5' y='125' width='65' height='65'/%3E%3Crect x='10' y='130' width='55' height='55'/%3E%3Crect x='15' y='135' width='45' height='45'/%3E%3Crect x='20' y='140' width='35' height='35'/%3E%3Crect x='25' y='145' width='25' height='25'/%3E%3Crect x='30' y='150' width='15' height='15'/%3E%3Crect x='35' y='155' width='5' height='5'/%3E%3Crect x='200' y='120' width='75' height='75'/%3E%3Crect x='40' y='200' width='75' height='75'/%3E%3Crect x='80' y='80' width='75' height='75'/%3E%3Crect x='85' y='85' width='65' height='65'/%3E%3Crect x='90' y='90' width='55' height='55'/%3E%3Crect x='95' y='95' width='45' height='45'/%3E%3Crect x='100' y='100' width='35' height='35'/%3E%3Crect x='105' y='105' width='25' height='25'/%3E%3Crect x='110' y='110' width='15' height='15'/%3E%3Crect x='115' y='115' width='5' height='5'/%3E%3Crect x='80' y='160' width='35' height='35'/%3E%3Crect x='85' y='165' width='25' height='25'/%3E%3Crect x='90' y='170' width='15' height='15'/%3E%3Crect x='95' y='175' width='5' height='5'/%3E%3Crect x='120' y='160' width='75' height='75'/%3E%3Crect x='125' y='165' width='65' height='65'/%3E%3Crect x='130' y='170' width='55' height='55'/%3E%3Crect x='135' y='175' width='45' height='45'/%3E%3Crect x='140' y='180' width='35' height='35'/%3E%3Crect x='145' y='185' width='25' height='25'/%3E%3Crect x='150' y='190' width='15' height='15'/%3E%3Crect x='155' y='195' width='5' height='5'/%3E%3Crect x='160' y='40' width='75' height='75'/%3E%3Crect x='165' y='45' width='65' height='65'/%3E%3Crect x='170' y='50' width='55' height='55'/%3E%3Crect x='175' y='55' width='45' height='45'/%3E%3Crect x='180' y='60' width='35' height='35'/%3E%3Crect x='185' y='65' width='25' height='25'/%3E%3Crect x='190' y='70' width='15' height='15'/%3E%3Crect x='195' y='75' width='5' height='5'/%3E%3Crect x='160' y='120' width='35' height='35'/%3E%3Crect x='165' y='125' width='25' height='25'/%3E%3Crect x='170' y='130' width='15' height='15'/%3E%3Crect x='175' y='135' width='5' height='5'/%3E%3Crect x='200' y='200' width='35' height='35'/%3E%3Crect x='200' width='35' height='35'/%3E%3Crect y='200' width='35' height='35'/%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
        <#include "./common/head.ftl">
<div class="tm-blog-img-container">
</div>
<section class="tm-section">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 col-xl-9">
                <div id="editor"><#if (edit_article)??>${edit_article}</#if></div>
                <textarea
                        style="border-style: dotted;width: 100%;height: 100px; outline: #5bc0de Solid 1px;resize: none;margin-top: 20px"
                        placeholder="文章感想..." id="feeling"><#if (edit_feeling)??>${edit_feeling}</#if></textarea>
                <form class="col-sm-12">
                    <div style="margin-top: 20px"><i class="fa fa-cubes" aria-hidden="true"></i> 选择分类:
                        <div class="btn-group" data-toggle="buttons">
                                    <#if (edit_type)??>
                                        <#list types as item>
                                            <#if edit_type==item.id>
                                                <label class="btn btn-primary active">
                                                    <input style="width: 20%" type="radio" checked="checked"
                                                           name="category" value=${item.id}>${item.typeName}
                                                </label>
                                            <#else>
                                                <label class="btn btn-primary">
                                                    <input style="width: 20%" type="radio" name="category"
                                                           value=${item.id}>${item.typeName}
                                                </label>
                                            </#if>
                                        </#list>
                                    <#else>
                                        <#list types as item>
                                            <label class="btn btn-primary">
                                                <input style="width: 20%" type="radio" name="category"
                                                       value=${item.id}>${item.typeName}
                                            </label>
                                        </#list>
                                    </#if>

                        </div>
                    </div>
                </form>
                <div class="col-sm-12">
                    <div style="margin-top: 20px">
                        <i class="fa fa-tags" aria-hidden="true"></i> 设置标签:
                        <input style="width: 60%;border-style: dashed" type="text" placeholder="多个标签需以逗号分隔"
                               id="newTags">
                        <button type="button" class="btn btn-info" onclick="addNewTags()"><i class="fa fa-floppy-o"
                                                                                             aria-hidden="true"></i>
                            添加新标签
                        </button>
                    </div>
                </div>

                <div class="col-sm-12" id="tagsAreaSide">
                    <div class="btn-group-sm" id="tagsArea" data-toggle="buttons">
                                <#if (tag_ids)??>
                                    <#list tags as item>
                                        <#if tag_ids?seq_contains(item.id)>
                                            <label class="btn btn-sm active"
                                                   style="background-color: #F6F6F6;color: #666666"
                                                   onclick="buttonChoose(this)">
                                                <input type="checkbox" name="tag" mark="checked" checked="checked"
                                                       value=${item.id}>${item.tagName}
                                            </label>
                                        <#else>
                                            <label class="btn btn-sm" style="background-color: #F6F6F6;color: #666666"
                                                   onclick="buttonChoose(this)">
                                                <input type="checkbox" name="tag" mark="unchecked"
                                                       value=${item.id}>${item.tagName}
                                            </label>
                                        </#if>
                                    </#list>
                                <#else>
                                    <#list tags as item>
                                        <label class="btn btn-sm" style="background-color: #F6F6F6;color: #666666"
                                               onclick="buttonChoose(this)">
                                            <input type="checkbox" name="tag" mark="unchecked"
                                                   value=${item.id}>${item.tagName}
                                        </label>
                                    </#list>
                                </#if>
                    </div>
                </div>
                <form class="col-sm-12">
                    <div style="margin-top: 20px"><i class="fa fa-rocket" aria-hidden="true"></i> 文章标题:
                        <input style="width: 60%;border-style: double" type="text" id="title"
                               placeholder="造个大新闻..."<#if (edit_title)??> value="${edit_title}"</#if>>
                        <button style="width: 10%" type="button" class="btn btn-primary" id="save"><i
                                class="fa fa-floppy-o" aria-hidden="true"></i> 保存
                        </button>
                        <button style="width: 10%" type="button" class="btn btn-success" id="announce"><i
                                class="fa fa-paper-plane-o" aria-hidden="true"></i> 发布
                        </button>
                    </div>
                </form>
            </div>
                    <#include "./common/write_sidebar.ftl">
        </div>
    </div>
</section>
        <#include "./common/foot.ftl">

<!-- load JS files -->
<script type="text/javascript" src="/js/jquery.min.js"></script>
<!-- jQuery (https://jquery.com/download/) -->
<script type="text/javascript" src="/js/tether.min.js"></script>
<!-- Tether for Bootstrap, http://stackoverflow.com/questions/34567939/how-to-fix-the-error-error-bootstrap-tooltips-require-tether-http-github-h -->
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<!-- Bootstrap (http://v4-alpha.getbootstrap.com/) -->
<script type="text/javascript"
        src="https://leiho-1252251484.cos.ap-shanghai.myqcloud.com/%E5%BC%80%E5%8F%91%E7%94%A8%E6%96%87%E4%BB%B6%E5%A4%B9/x-space/html5shiv.min.js"></script>
<script type="text/javascript"
        src="https://leiho-1252251484.cos.ap-shanghai.myqcloud.com/%E5%BC%80%E5%8F%91%E7%94%A8%E6%96%87%E4%BB%B6%E5%A4%B9/x-space/respond.min.js"></script>

<script type="text/javascript" src="/js/wangEditor.min.js">

</script>
<script type="text/javascript">
    var E = window.wangEditor
    var editor = new E('#editor')
    editor.customConfig.uploadImgServer = '/v1/upload'
    editor.customConfig.uploadFileName = 'multipartFile'
    editor.customConfig.uploadImgMaxSize = 5 * 1024 * 1024
    editor.customConfig.debug = true
    editor.customConfig.zIndex = 1000
    editor.create()
            <#if (edit_id)??>
                editor.article_id = ${edit_id}
            </#if>
            document.getElementById('save').addEventListener('click', function () {
                var article = getValue()
                save(article)
            }, false)

    document.getElementById('announce').addEventListener('click', function () {
        var article = getValue()
        announce(article)
    }, false)

    function getValue() {
        var article = {}
        article.id = editor.article_id
        article.content = editor.txt.html()
        article.title = $('#title').val()
        article.type = $('input:radio[name="category"]:checked').val()
        article.feeling = $('#feeling').val()
        article.tags = getTags()
        return article
    }

    function addNewTags() {
        var tags = $('#newTags').val()
        if (tags != null && tags != "" && tags != "''") {
            $.ajax({
                url: "/v1/addNewTags",
                type: "post",
                contentType: "application/json; charset=UTF-8",
                data: JSON.stringify(tags),
                success: function (data) {
                    if (data.code == 1000) {
                        $("#tagsArea").remove();
                        var newTags = "<div class=\"btn-group-sm\" id=\"tagsArea\" data-toggle=\"buttons\">"
                        $.each($.parseJSON("[" + data.tags + "]"), function (n, item) {
                            newTags +=
                                    "<label class=\"btn btn-sm\" style=\"background-color: #F6F6F6;color: #666666\" onclick=\"buttonChoose(this)\">\n" +
                                    "  <input type=\"checkbox\" name=\"tag\" mark=\"unchecked\" value=" + item.id + ">" + item.tagName + "\n" +
                                    "</label>"
                        });
                        newTags += "</div>"
                        $("#tagsAreaSide").append(newTags)
                        $("#tagsAreaSide").load(location.href + " #tagsAreaSide");
                    } else {
                        $("#modal_title").text("警告");
                        $("#modal_content").text(data.msg);
                        $('#commonModal').modal('show')
                    }
                }
            })
        }
    }

    function getTags() {
        var tagList = [];
        $('input:checkbox[name="tag"]:checked').each(function () {
            tagList.push($(this).val());
        });
        if (tagList.length > 0) {
            var tags = tagList[0];
            if (tagList.length > 1) {
                for (var i = 1; i < tagList.length; i++) {
                    tags = tags + "," + tagList[i]
                }
            }
            return tags
        }
    }

    function save(article) {
        $.ajax({
            url: "/v1/write/save",
            type: "post",
            contentType: "application/json; charset=UTF-8",
            data: JSON.stringify(article),
            success: function (data) {
                if (data.id != null) {
                    //将id写入
                    editor.article_id = data.id
                }
                if (data.code == 1000) {
                    $("#modal_title").text("提示");
                } else {
                    $("#modal_title").text("警告");
                }
                $("#modal_content").text(data.msg);
                $('#commonModal').modal('show')
            }
        })
    }

    function announce(article) {
        $.ajax({
            url: "/v1/write/announce",
            type: "post",
            contentType: "application/json; charset=UTF-8",
            data: JSON.stringify(article),
            success: function (data) {
                if (data.id != null) {
                    //将id写入
                    editor.article_id = data.id
                }
                if (data.code == 1000) {
                    $("#modal_title").text("提示");
                } else {
                    $("#modal_title").text("警告");
                }
                $("#modal_content").text(data.msg);
                $('#commonModal').modal('show')
            }
        })
    }

    function buttonChoose(e) {
        if ("checked" != e.mark) {
            e.mark = "checked";
            e.style.backgroundColor = "#FEC04E";
            e.style.color = "#FFFFFF";
        } else {
            e.mark = "unchecked";
            e.style.backgroundColor = "#F6F6F6"
            e.style.color = "#666666"
        }
    }

    $("input[mark='checked']").parent().css({"background-color": "#FEC04E", "color": "#FFFFFF"});
    $("input[mark='unchecked']").parent().css({"background-color": "#F6F6F6", "color": "#666666"});
</script>
</body>
</html>